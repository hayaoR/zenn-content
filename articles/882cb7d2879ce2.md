---
title: "Javaã§ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã¯ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã‹"
emoji: "ğŸˆ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["java"]
published: true 
---

## ã¯ã˜ã‚ã«
ã¿ãªã•ã‚“ã¯ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹(Algebraic Data Type; ADT)ã‚’ã”å­˜çŸ¥ã§ã—ã‚‡ã†ã‹ï¼Ÿ[^1]ç§ã¯ADTã‚’ä½¿ã£ã¦ã‹ã‚‰ã‚‚ã†ADTãŒãªã„è¨€èªã§ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã—ãŸããªããªã£ã¦ã—ã¾ã„å¤§å¤‰å›°ã£ã¦ã„ã¾ã™.
Javaã¯æ¥­ç•Œã§åºƒãä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªã®ã§,Javaã«ADTãŒã‚ã£ãŸã‚‰ãªã‚ã¨æ€ã†ã‚ã‘ã§ã™ãŒ,ã¡ã‚‰ã»ã‚‰Javaç•Œéšˆã§ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã¨ã„ã†ç”¨èªã‚’è€³ã«ã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ.
ãã“ã§ã‚‚ã—ã‹ã—ã¦Javaã§ADTãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ï¼Ÿã¨æ€ã„,èª¿ã¹ã¦è¦‹ã¾ã—ãŸ.

## çµè«–
æ›¸ã‘ã‚‹ã£ã¡ã‚ƒæ›¸ã‘ã‚‹..ã®ã‹ï¼Ÿ

## Javaã«ãŠã‘ã‚‹ADTã£ã½ã„æ©Ÿèƒ½

## Sealed Classes/Interfaces
Sealed Classes/Interfacesã¯ç¶™æ‰¿,å®Ÿè£…ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’åˆ¶é™ã§ãã‚‹ã‚¯ãƒ©ã‚¹ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã§ã™.Java17ã§æ­£å¼ãªæ©Ÿèƒ½ã¨ãªã‚Šã¾ã—ãŸ.ç¶™æ‰¿,å®Ÿè£…ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’åˆ¶é™ã™ã‚‹ã“ã¨ã§ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒã®ã¨ãã«ç¶²ç¾…æ€§ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™.


## Pattern Matching for switch
Javaã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒãƒƒãƒ(=switchæ–‡/å¼)ã¯æ•°å­—,String,enumã—ã‹å–ã‚Œãš,caseãƒ©ãƒ™ãƒ«ã¯å®šæ•°ã—ã‹è¨±ã•ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸãŒ,Java 17ã§[preview feature](https://docs.oracle.com/en/java/javase/18/language/preview-language-and-vm-features.html)ã¨ã—ã¦ä»»æ„ã®å‹ã‚’å–ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Š,caseãƒ©ãƒ™ãƒ«ã¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å–ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ.


## Resultã¯æ›¸ã‘ã‚‹ã‹ï¼Ÿ
ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦Rustã®Resultç›¸å½“ã®ã‚‚ã®ã‚’æ›¸ã„ã¦ã¿ã¾ã—ãŸ.

ã‚³ãƒ¼ãƒ‰ã¯IntelliJ IDEA 2022.1ã§å®Ÿè¡Œ,sdkã¯openjdk-18 version18.0.1,Language Levelã¯18(Preview) - Pattern matching for switch (second preview)ã§ã™.

:::message
Javaã©ç´ äººãªã®ã§å¤‰ãªæ›¸ãæ–¹ã‚’ã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™.
:::

```java:Result.java
sealed interface Result<T, E> {
}

record Ok<T, E>(T t) implements Result<T, E> { }

record Err<T, E>(E e) implements Result<T, E> { }
```

```java:Main.java
public class Main {

    public static void main(String[] args) {

        var result = div(6.0, 3.0);

        var answer = switch (result) {
            //å†—é•·ãªè¨˜è¿°
            case Ok<Double, String> ok -> ok.t();
            case Err<Double, String> err -> throw new RuntimeException(err.e());
        };

        System.out.println(answer);
    }

    //å‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒãªã„
    static Result<Double, String> div(double a, double b) {
        if (Double.compare(b, 0.0) == 0) {
            return new Err<>("Division by zero");
        }
        return new Ok<>(a / b);
    }

}
```

```bash:output
2.0
```

æ›¸ã‘ã¦ã„ã‚‹ã£ã¡ã‚ƒæ›¸ã‘ã¦ã„ã‚‹æ°—ã‚‚ã—ã¾ã™ãŒ,å‹ã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒç„¡ã„ã®ãŒè¾›ã„ã®ã¨,caseã«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›¸ã‹ãªã‘ã‚Œã°ã„ã‘ãªã„æ°—ãŒã™ã‚‹ã®ã‚‚å†—é•·ã§è¾›ã„ã§ã™..

## çµ‚ã‚ã‚Šã«
ã“ã®è¨˜äº‹ã§ã¯Javaã§ä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ãŒä½¿ãˆã‚‹ã®ã‹èª¿ã¹ã¦è¦‹ã¾ã—ãŸ.ã¾ã‚ä½¿ãˆã‚‹ã£ã¡ã‚ƒä½¿ãˆã‚‹ã®ã‹ãªï¼Ÿã¨ã„ã†æ„Ÿã˜ã§ã—ãŸ.Sealed Classesã¨Pattern Matching for switchã¯ãªã‹ãªã‹è‰¯ã•ãã†ãªæ©Ÿèƒ½ã§ã™ã­.
[JEP427](https://openjdk.java.net/jeps/427):Pattern Matching for switch (Third Preview)ã®Future workã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªè„±æ§‹ç¯‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚ç¤ºã•ã‚Œã¦ã„ã¦,ã‚ˆã‚Šä½¿ã„å‹æ‰‹ãŒå¢—ã—ãã†ã§ã™.

```java:deconstruction patterns
int eval(Expr n) {
     return switch (n) {
         case IntExpr(int i) -> i;
         case NegExpr(Expr n) -> eval(n);
         case AddExpr(Expr left, Expr right) -> eval(left) + eval(right);
         case MulExpr(Expr left, Expr right) -> eval(left) * eval(right);
         default -> throw new IllegalStateException();
     };
}
```



## å‚è€ƒæ–‡çŒ®
https://docs.oracle.com/en/java/javase/18/language


[^1]: ã€Œä»£æ•°çš„ãƒ‡ãƒ¼ã‚¿å‹ã€ã§ã‚°ã‚°ã‚‹ã¨ã„ã‚ã„ã‚ãªè¨˜äº‹ãŒå‡ºã¦ãã‚‹ã®ã§ãœã²èª¿ã¹ã¦ã¿ã¦ãã ã•ã„.