---
title: "AxumでGoのチュートリアル「Writing Web Application」をやってみた"
emoji: "🦀"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: []
published: false
---

# はじめに
私は現在プログラム初心者ですが、エンジニアとしてのスキルをこれから高めていきたいと思っています。
とりあえず、社会で比較的需要の多い、Webバックエンド開発の基礎を習得したいと思いました。
Webバックエンドのフレームワークは星の数ほどあれど、それらに共通した要素は多いはずで、それを習得してしまえば、新たなフレームワークを学ぶのは容易になると思ったので、まず１つのWebフレームワークについて習熟していきたいと思いました。
仕事と違い好きに選べるなら自分の好きな言語のフレームワークを選びたいということでAxumを選びました。
ただAxumは現在も活発に開発されている新しいフレームワークで、チュートリアルなどが見当たらないので、Goのnet/httpのチュートリアル「Writing Web Application」をAxumでやってみました。


# Axumとは
Axumは非常にスリムなフレームワークです。AxumはGitHubのREADMEに書かれているように**Ergonomics**と**Modularity**にフォーカスしています。

# Modularity
## 色々なクレートがレゴブロックのように組み合わされています。
たとえば非同期ランタイムは`tokio`、サーバーは`hyper`、Requestを受け取りResponseを返すものを抽象化したサービスは`tower`を用いられています。
作者はaxumは実際"tower::Serviceをルーティングするフレームワークである"と言っています。

# Ergonomics
Ergonomicsは人間工学という意味だそうです。使いやすさを重視しているということでしょう。
## 特徴
- マクロフリーなルーティング
Webフレームワークの中にはアノテーション(マクロ)でルーティングするWebフレームワークも多いですが、Axumはその方式は採用していません。
マクロは非常に高い表現力ゆえに、何をしているのか分かりづらいという側面があるので、Axumの作者はなるべく使用を避けようとしているのでしょう。
とはいえ、マクロは使いすぎなければ、非常に便利で効果的な機能なので、これは好みの問題も大きい気がします。

- 宣言的なリクエストとレスポンスのパース
Goのnet/httpやechoだとハンドラは、要求されたインターフェイスを実装した構造体に対して、操作を施し、リクエストからデータを抽出したりレスポンスを返したりしたりする方式を採用していますが、Axumではハンドラはリクエストは0個以上のExtractorを実装した型でレスポンスがIntoResponseを実装した型です。言葉だと分かりづらいので具体例で比較してみます。

# Gowiki
「Writing Web Application」はGowikiという超簡易的なWikiを作るチュートリアルです。
簡単のためWikiのページはファイルで管理されています。
ページの参照、編集(新規作成)、保存機能が提供されています。
私が書いたAxumによる実装は以下にあります。

# 同じ機能を実装したAxumとnet/httpのコードを見比べたときの所感
net/httpはGoが標準で提供しているパッケージでこれを素で使うことは少ないでしょうが、ginもechoもnet/httpのラッパーということなので[引用]()比較対象としては良いでしょう。

## Routing
net/httpでまず気になったのがパット見ハンドラがルータに紐付けられているように見えないことです。
この[記事]が非常に参考になりましたが、`DefaultServeMux`というグローバル変数が存在していて`handlerFunc`が呼ばれると`DefaultServeMux`に紐付けれるそうです。
そして、`http.ListenAndServe`の第2引数に`nil`が渡されるとサーバーに`DefaultServeMux`が渡されるという作りになっています。
知ってしまえばなんてことないですが、私のような初心者がコードだけを見ると、最初は首をかしげるような仕組みになっていると感じました。
